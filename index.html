<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Morse Trainer - Stats Added</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        #word {
            font-size: 15vmin; 
            letter-spacing: 2vmin;
            margin-bottom: 1vh;
            text-shadow: 0 0 4vmin #0f0;
            text-align: center;
            margin-top: 5vh; /* Info panellar bilan ustma-ust tushmasligi uchun joy */
        }

        #timer {
            font-size: 10vmin;
            margin-bottom: 2vh;
            color: #0ff;
            font-weight: bold;
        }

        #currentInput {
            font-size: 10vmin;
            margin-bottom: 2vh;
            color: #0ff;
            min-height: 8vmin;
        }

        #inputLine {
            font-size: 8vmin;
            letter-spacing: 2vmin;
            margin-bottom: 5vh;
            text-align: center;
        }

        #button {
            width: 25vmin;
            height: 25vmin;
            min-width: 200px;
            min-height: 200px;
            border-radius: 50%;
            background: #111;
            border: 1.5vmin solid #0f0;
            box-shadow: 0 0 6vmin #0f0;
            cursor: pointer;
            user-select: none;
            font-size: 5vmin;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }

        #button.pressed {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 15vmin #0f0;
            transform: scale(0.9);
        }

        .wrong {
            animation: shake 0.6s;
            background: #600;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2vmin); }
            75% { transform: translateX(2vmin); }
        }

        /* Ikkala panel uchun umumiy stil (dizayn bir xil bo'lishi uchun) */
        .info, .stats {
            position: absolute;
            top: 2vh;
            font-size: 3vmin;
            color: #0a0;
            background: #111;
            padding: 1.5vmin;
            border: 0.3vmin solid #0f0;
            border-radius: 1.5vmin;
            z-index: 10;
            line-height: 1.4;
        }

        .info {
            left: 2vh;
            text-align: left;
        }

        /* Yangi qo'shilgan qism: O'ng yuqori burchak */
        .stats {
            right: 2vh;
            text-align: right;
        }
        
        @media (max-width: 400px) {
            #button {
                width: 60vw;
                height: 60vw;
                min-width: auto;
                min-height: auto;
            }
            .info, .stats {
                font-size: 3.5vmin; /* Mobil uchun sal kattaroq o'qilishi uchun */
                padding: 1vmin;
            }
        }
    </style>
</head>
<body>

<!-- Chap panel: Yo'riqnoma -->
<div class="info">
    Short → .<br>Hold → —
</div>

<!-- O'ng panel: Statistika -->
<div class="stats">
    Word: <span id="scoreVal" style="color:#fff">0</span><br>
    Fail: <span id="errorVal" style="color:#f00">0</span>
</div>

<div id="word">START</div>
<div id="timer">5.0</div>
<div id="currentInput"></div>
<div id="inputLine">_ _ _ _ _</div>
<div id="button">PRESS</div>

<script>
    const words = ["HELLO","WORLD","MORSE","CODE","RADIO","YES","YOU","FRIEND","HOME","LOVE","PEACE","GOOD","NIGHT","STAR","MOON","SKY","WAVE","TEST","SOS"];

    const morseToLetter = {
        '.-':'A', '-...':'B', '-.-.':'C', '-..':'D', '.':'E', '..-.':'F',
        '--.':'G', '....':'H', '..':'I', '.---':'J', '-.-':'K', '.-..':'L',
        '--':'M', '-.':'N', '---':'O', '.--.':'P', '--.-':'Q', '.-.':'R',
        '...':'S', '-':'T', '..-':'U', '...-':'V', '.--':'W', '-..-':'X',
        '-.--':'Y', '--..':'Z'
    };

    let currentWord = "";
    let guessed = [];
    let currentCode = "";
    let timer = null;
    let timeLeft = 5.0;
    
    // Statistika o'zgaruvchilari
    let score = 0;
    let errors = 0;

    const wordEl = document.getElementById("word");
    const timerEl = document.getElementById("timer");
    const currentEl = document.getElementById("currentInput");
    const inputEl = document.getElementById("inputLine");
    const button = document.getElementById("button");
    const scoreEl = document.getElementById("scoreVal");
    const errorEl = document.getElementById("errorVal");

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function play(dur, freq=800){
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.frequency.value = freq; o.type = "sine"; g.gain.value = 0.5;
        o.start(); o.stop(audioCtx.currentTime + dur/1000);
    }

    function startTimer(){
        clearInterval(timer);
        timeLeft = 5.0;
        timerEl.textContent = "5.0";
        timerEl.style.color = "#0ff";

        timer = setInterval(() => {
            timeLeft -= 0.1;
            timerEl.textContent = timeLeft.toFixed(1);
            if(timeLeft <= 1.0) timerEl.style.color = "#ff0";
            if(timeLeft <= 0){
                clearInterval(timer);
                checkAfterTimeout(); 
            }
        }, 100);
    }

    function checkAfterTimeout(){
        const expectedLetter = currentWord[guessed.length];
        const enteredLetter = morseToLetter[currentCode];

        if(enteredLetter === expectedLetter){
            guessed.push(expectedLetter);
            currentCode = "";
            currentEl.textContent = "";
            updateLine();
            play(300, 1200);
            
            // So'z to'liq topilganda SCORE oshadi
            if(guessed.length === currentWord.length){
                score++;
                scoreEl.textContent = score;
                setTimeout(newWord, 1200);
            } else {
                setTimeout(startTimer, 800);
            }
        } else {
            wrong();
        }
    }

    function wrong(){
        // Xato bo'lganda FAIL oshadi
        errors++;
        errorEl.textContent = errors;
        
        document.body.classList.add("wrong");
        play(600, 300);
        setTimeout(() => {
            document.body.classList.remove("wrong");
            guessed = [];
            currentCode = "";
            currentEl.textContent = "";
            updateLine();
            startTimer();
        }, 1000);
    }

    function newWord(){
        if(words.length === 0){
            wordEl.textContent = "WIN!";
            inputEl.textContent = "Score: " + score;
            clearInterval(timer);
            button.style.display = "none";
            return;
        }
        const i = Math.floor(Math.random() * words.length);
        currentWord = words.splice(i, 1)[0];
        guessed = [];
        currentCode = "";
        wordEl.textContent = currentWord;
        updateLine();
        currentEl.textContent = "";
        startTimer();
    }

    function updateLine(){
        let s = "";
        for(let i = 0; i < currentWord.length; i++) s += (guessed[i] || "_") + " ";
        inputEl.textContent = s.trim();
    }

    let pressStart = 0;
    const LONG_PRESS = 500;

    button.addEventListener("mousedown", e => {
        pressStart = Date.now();
        button.classList.add("pressed");
    });

    button.addEventListener("mouseup", e => {
        if(!button.classList.contains("pressed")) return;
        const dur = Date.now() - pressStart;
        button.classList.remove("pressed");

        const sym = dur < LONG_PRESS ? "." : "-";
        currentCode += sym;

        currentEl.textContent = currentCode.replace(/\./g,"• ").replace(/-/g,"— ").trim();
        play(dur < LONG_PRESS ? 120 : 360, 900);
    });
    
    button.addEventListener("touchstart", e=>{
        e.preventDefault(); 
        pressStart = Date.now();
        button.classList.add("pressed");
    });
    
    button.addEventListener("touchend", e=>{
        e.preventDefault(); 
        if(!button.classList.contains("pressed")) return;
        const dur = Date.now() - pressStart;
        button.classList.remove("pressed");

        const sym = dur < LONG_PRESS ? "." : "-";
        currentCode += sym;

        currentEl.textContent = currentCode.replace(/\./g,"• ").replace(/-/g,"— ").trim();
        play(dur < LONG_PRESS ? 120 : 360, 900);
    });

    newWord();
    document.body.addEventListener("click", () => audioCtx.resume(), {once:true});
    document.body.addEventListener("touchstart", () => audioCtx.resume(), {once:true});
</script>
</body>
</html>
